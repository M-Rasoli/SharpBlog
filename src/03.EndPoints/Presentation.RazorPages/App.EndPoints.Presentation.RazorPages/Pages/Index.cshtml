@page 
@model IndexModel
@{
    ViewData["Title"] = "خانه";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<!-- محتوای اصلی فید -->
<main class="max-w-lg mx-auto px-4 pt-6 pb-24">
    <form method="get"
          class="mb-4 flex flex-col md:flex-row md:items-center gap-3 bg-white border border-gray-200 rounded-xl shadow-sm p-4">
        <div class="flex items-center gap-2">
            <label asp-for="@Model.CategoryFilter" class="text-gray-700 font-medium whitespace-nowrap">
                انتخاب دسته بندی:
            </label>

            <select asp-for="@Model.CategoryFilter"
                    @* onchange="this.form.submit()" *@
                    class="appearance-none bg-gray-50 border border-gray-300 text-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 font-[inherit]">

                <option value="">همه</option>

                @foreach (var day in Model.Categories)
                {
                    <option value="@day.Title">
                        @day.Title
                    </option>
                }

            </select>
        </div>
        <button type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-5 py-3 rounded-lg shadow transition duration-150">
            🔍 جستجو
        </button>

    </form>
    <!-- فید پست‌ها -->
    @if (Model.Feeds != null && Model.Feeds.Any())
    {
        @foreach (var post in Model.Feeds)
        {
            <article class="post-card bg-white rounded-2xl mb-8 overflow-hidden shadow-lg">
                <!-- هدر پست -->
                <div class="flex items-center justify-between p-4">

                    <button type="button">
                        <i data-lucide="more-horizontal" class="w-6 h-6 text-gray-600"></i>
                    </button>
                </div>
                <!-- تصویر پست + انیمیشن لایک دوبل‌کلیک -->
                <div class="relative bg-black">
                    <div class="post-media-area aspect-square cursor-pointer">
                        <img src="/@post.ImgUrl" alt="پست @post.Title" class="w-full h-full object-cover">
                    </div>
                </div>

                <!-- اکشن‌ها و اطلاعات -->
                <div class="p-4">

                    <!-- کپشن -->
                    <!-- کپشن و متن پست -->
                    <div class="mt-2">
                        <p class="text-sm font-bold text-gray-900 mb-2">
                            عنوان: @post.Title
                        </p>

                        <div class="text-sm leading-relaxed text-gray-800 break-words">
                            @if (post.Text.Length > 210)
                            {
                                <text>@post.Text.Substring(0, 210)<span class="text-gray-500">...</span> </text>

                            }
                            else
                            {
                                @post.Text
                            }
                        </div>
                    </div>
                    <div class="p-4 pt-0">
                        <a asp-page="/Posts/WithDetails"
                           asp-route-id="@post.Id"
                           class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-gray-900 hover:bg-gray-800 text-white text-sm font-medium rounded-xl transition shadow">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i>
                            مشاهده جزئیات
                        </a>
                    </div>
                    <div class="p-4 pt-0">
                        <a asp-page="/Comments/List"
                           asp-route-id="@post.Id"
                           class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-gray-900 hover:bg-gray-800 text-white text-sm font-medium rounded-xl transition shadow">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i>
                            مشاهده نظرات
                        </a>
                    </div>
                    <div class="p-4 pt-0">
                        <a asp-page="/Comments/Create"
                           asp-route-id="@post.Id"
                           class="group inline-flex items-center gap-2 mt-4 px-6 py-3
                                    bg-white hover:bg-gray-50
                                    text-gray-700 hover:text-gray-900
                                    border-2 border-gray-300 hover:border-gray-400
                                    font-medium rounded-xl
                                    transition-all duration-200
                                    shadow hover:shadow-lg">
                            <i data-lucide="plus" class="w-5 h-5 text-gray-600 group-hover:text-gray-800 transition"></i>
                            ثبت نظر
                        </a>
                    </div>
                    <!-- تاریخ -->
                    <p class="text-xs text-gray-400 mt-4">
                        @post.CreatedAtShamsi <!-- یا هر متدی که داری -->
                    </p>
                </div>
            </article>

        }
        <!-- صفحه‌بندی (Pagination) - فقط HTML خالص برای تست -->
        <!-- متن کوچک زیر صفحه‌بندی (اختیاری) -->
        @* <p class="text-center text-xs text-gray-500">
            صفحه @Model.Page از @Model.TotalPage (@Model.PostCount پست)
        </p> *@
    }
    else
    {
        <div class="text-center py-20">
            <i data-lucide="image-off" class="w-24 h-24 text-gray-300 mx-auto mb-4"></i>
            <p class="text-lg text-gray-500 font-medium">هنوز پستی منتشر نشده</p>
            <p class="text-sm text-gray-400 mt-2">اولین پست خودت رو بساز!</p>
        </div>
    }
</main>
